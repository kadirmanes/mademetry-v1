<VirtualHost *:443>
    ServerName mademetry.com
    ServerAlias www.mademetry.com

    DocumentRoot /var/www/mademetry_clean/dist/public

    # --- EN ÜSTE TAŞIDIK (ÖNCELİK BUNLARDA) ---
    # Önce API isteklerini yönlendir
    ProxyPass /api http://127.0.0.1:5000/api
    ProxyPassReverse /api http://127.0.0.1:5000/api

    # Sonra Uploads isteklerini yönlendir (KRİTİK KISIM)
    ProxyPass /uploads http://127.0.0.1:5000/uploads
    ProxyPassReverse /uploads http://127.0.0.1:5000/uploads

    # Sonra Objects isteklerini yönlendir
    ProxyPass /objects http://127.0.0.1:5000/objects
    ProxyPassReverse /objects http://127.0.0.1:5000/objects
    # ------------------------------------------

    # React/Frontend Ayarları (Bunlar altta kalsın)
    <Directory /var/www/mademetry_clean/dist/public>
        Options FollowSymLinks
        AllowOverride All
        Require all granted

        RewriteEngine On
        RewriteBase /
        RewriteRule ^index\.html$ - [L]
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteCond %{REQUEST_FILENAME} !-d
        RewriteRule . /index.html [L]
    </Directory>

    SSLEngine on
    SSLCertificateFile /etc/letsencrypt/live/mademetry.com/fullchain.pem
    SSLCertificateKeyFile /etc/letsencrypt/live/mademetry.com/privkey.pem

    ErrorLog ${APACHE_LOG_DIR}/mademetry_error.log
    CustomLog ${APACHE_LOG_DIR}/mademetry_access.log combined
</VirtualHost>
